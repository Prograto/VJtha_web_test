<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EAPCET Exam</title>
  <link rel="stylesheet" href="eapcetexam.css">
</head>
<body>
  <div id="intro">
    <h1>EAPCET Mock Exam</h1>
    <h3>Title: <span id="title"></span></h3>
    <p><strong>Instructions:</strong></p>
    <ul>
      <li>Total duration: 30 minutes</li>
      <li>Each question carries 1 mark</li>
      <li>No negative marking</li>
      <li>Do not refresh the page during the exam</li>
    </ul>
    <button onclick="startExam()">Start Exam</button>
  </div>

  <!-- This div will hold the actual exam UI after start -->
  <div id="exam" style="display: none;"></div>
  

  <script>
let violationCount = 0;
const maxViolations = 1;
let examSubmitted = false;  // ✅ Flag to prevent multiple submissions

function handleViolation(reason) {
    if (examSubmitted) return;  // ✅ Prevent multiple alerts

    violationCount++;
    alert(`Violation detected: ${reason}`);

    if (violationCount >= maxViolations) {
        alert("Exam auto-submitted due to policy violation!");
        submitExam();
    }
}

function startExam() {
    // Fullscreen request
    const elem = document.documentElement;
    if (elem.requestFullscreen) {
        elem.requestFullscreen();
    } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
    }

    document.body.style.overflowX = 'hidden';

    document.addEventListener('contextmenu', event => event.preventDefault());

    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            handleViolation("Tab switch or window change detected!");
        }
    });

    window.onblur = () => {
        handleViolation("Window unfocused!");
    };

    window.addEventListener("keydown", function (e) {
        if (
            e.key === "F12" ||
            e.ctrlKey || e.metaKey || e.altKey
        ) {
            e.preventDefault();
            handleViolation("Forbidden keyboard shortcut used!");
        }
    });

    // ✅ Handle exit from fullscreen
    document.addEventListener("fullscreenchange", () => {
        if (!document.fullscreenElement) {
            handleViolation("Exited fullscreen mode!");
        }
    });

    document.getElementById("intro").style.display = "none";
    document.getElementById("exam").style.display = "block";
    loadExamUI();
}

function submitExam() {
    if (examSubmitted) return;  // ✅ Prevent multiple submissions

    saveAnswer();
    const unanswered = answers.filter(a => !a).length;

    const confirmSubmit = unanswered > 0
        ? confirm(`You have ${unanswered} unanswered questions. Do you still want to submit?`)
        : true;

    if (!confirmSubmit) return;

    let score = 0;
    questions.forEach((q, i) => {
        if (answers[i] && answers[i] === q.solution.toString()) score++;
    });

    alert(`You scored ${score} out of ${questions.length}`);
    examSubmitted = true;  // ✅ Block further alerts or actions
    window.location.href = "user.html";

}

  </script>
  <script src="eapcetexam.js"></script>
</body>
</html>
